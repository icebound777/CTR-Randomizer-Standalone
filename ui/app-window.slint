import {LineEdit, Button, VerticalBox, HorizontalBox, CheckBox, TabWidget, AboutSlint, ComboBox, Switch, Spinner}from "std-widgets.slint";

component TitleBar inherits Rectangle {
    border-color: black;
    border-width: 2px;

    HorizontalLayout {
        Rectangle {
            border-color: black;
            border-width: 2px;
            background: white;
            height: parent.height;
            width: parent.height;
            Image {
                source: @image-url("../res/CTR_logo.png");
                height: parent.height - 4 * 1px;
                width: parent.height - 4 * 1px;
            }
        }

        Text {
            text: "CTR Randomizer (pre-alpha)";
            font-weight: 800;
            font-size: 40pt;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
}

component SettingsMetaBar inherits Rectangle {
    HorizontalLayout {
        alignment: space-evenly;
        padding: 4px;
        Text {
            text: "Settings Hash:";
            vertical-alignment: center;
            horizontal-alignment: center;
            font-size: 20pt;
        }

        VerticalBox {
            alignment: space-evenly;
            LineEdit {
                height: parent.height / 2;
                width: 200px;
                horizontal-alignment: left;
                read-only: true;
            }
        }

        Button {
            text: "Export Settings";
            height: parent.height * (2/3);
            width: 200px;
        }
        Button {
            text: "Import Settings";
            height: parent.height * (2/3);
            width: 200px;
        }
    }
}

component RandomizationSubmenu inherits Rectangle {
    VerticalLayout {
        Rectangle {
            height: 60px;
            border-color: black;
            border-width: 1px;
            Text {
                x: 380px;
                y: 22px;
                text: "Randomize:";
                font-size: 10pt;
                font-weight: 800;
            }
            chosen_randomization := ComboBox {
                x: 480px;
                y: 14px;
                width: 200px;
                model: ["Nothing", "Adventure"];
                current-index: 1;
            }
        }
        Rectangle {
            visible: chosen_randomization.current-index == 1;
            Text {
                y: 14px;
                text: "Adventure Randomization";
                font-size: 12pt;
                font-weight: 800;
            }

            Switch {
                y: 40px;
                text: "Shuffle Race Rewards";
            }
            Switch {
                y: 80px;
                text: "Shuffle Warp Pads";
            }
            Text {
                y: 130px;
                x: parent.x + 310px;
                text: "Warp Pad Unlock Requirements";
                font-size: 10pt;
            }
            ComboBox {
                y: 122px;
                x: 530px;
                model: ["Vanilla", "Shuffled", "More Choices", "Wild", "Chaotic"];
            }
            Switch {
                y: 170px;
                text: "Auto-Unlock CTR Challenge & Relic Race";
            }
        }
    }
}

component GeneralSubmenu inherits Rectangle {
    VerticalLayout {
        alignment: start;
        width: 500px;
        HorizontalBox {
            height: 60px;
            Text {
                vertical-alignment: center;
                text: "Relic Races: Required Minimum Rank";
            }
            ComboBox {
                width: 250px;
                model: ["Any Time", "Gold Time or better", "Platinum Time"];
            }
        }
        Switch {
            text: "Relic Races: Require Perfects";
        }
        HorizontalBox {
            height: 60px;
            Text {
                vertical-alignment: center;
                text: "Oxide's Final Challenge Unlock";
            }
            ComboBox {
                width: 250px;
                model: ["18 Sapphire Relics", "18 Gold+Platinum Relics"];
            }
        }
    }
}

component QoLSubmenu inherits Rectangle {
    out property <bool> qol_skip_mask_hints;
    out property <bool> qol_skip_podium;
    out property <bool> qol_skip_mask_congrats;

    Switch {
        y: 10px;
        height: 50px;
        text: "Skip Mask Hints";
        toggled => {root.qol_skip_mask_hints = self.checked}
    }
    Switch {
        y: 60px;
        height: 50px;
        text: "Auto-Skip Podium Cutscenes";
        toggled => {root.qol_skip_podium = self.checked}
    }
    Switch {
        y: 110px;
        height: 50px;
        text: "Skip Mask Congrats";
        toggled => {root.qol_skip_mask_congrats = self.checked}
    }
}

component AboutSubmenu inherits Rectangle {
    callback sources_generator();
    callback sources_mod();

    Text {
        y: 10px;
        text: "The CTR Randomizer mod is made by";
        horizontal-alignment: center;
        vertical-alignment: center;
        font-weight: 800;
        font-size: 10pt;
    }
    Text {
        y: 30px;
        text: "wiz_taor";
        horizontal-alignment: center;
        vertical-alignment: center;
        font-weight: 800;
        font-size: 10pt;
    }
    Text {
        y: 50px;
        text: "Icebound777";
        horizontal-alignment: center;
        vertical-alignment: center;
        font-weight: 800;
        font-size: 10pt;
    }

    Text {
        y: 100px;
        text: "Sources of this seed generator:";
        horizontal-alignment: center;
        vertical-alignment: center;
        font-weight: 800;
        font-size: 10pt;
    }
    TouchArea {
        height: 30px;
        width: 75px;
        y: 120px;
        clicked => {root.sources_generator();}
        Button {
            enabled: false;
            height: 34px;
            width: 80px;
        }
        Image {
            source: @image-url("../res/GitHub_Logo.png");
            height: 30px;
            width: 75px;
        }
    }

    Text {
        y: 160px;
        text: "Sources of the randomizer mod:";
        horizontal-alignment: center;
        vertical-alignment: center;
        font-weight: 800;
        font-size: 10pt;
    }
    TouchArea {
        height: 30px;
        width: 75px;
        y: 180px;
        clicked => {root.sources_mod();}
        Button {
            enabled: false;
            height: 34px;
            width: 80px;
        }
        Image {
            source: @image-url("../res/GitHub_Logo.png");
            height: 30px;
            width: 75px;
        }
    }

    AboutSlint {
        x: 370px;
        y: 170px;
        height: 150px;
    }
    Text {
        y: 300px;
        text: "('User Interface design is my passion' lmao)";
        horizontal-alignment: center;
        vertical-alignment: top;
        font-weight: 800;
        font-size: 8pt;
    }
}

component SettingsMenu inherits TabWidget {
    callback sources_generator();
    callback sources_mod();

    out property <bool> qol_skip_mask_hints <=> qolmenu.qol_skip_mask_hints;
    out property <bool> qol_skip_podium <=> qolmenu.qol_skip_podium;
    out property <bool> qol_skip_mask_congrats <=> qolmenu.qol_skip_mask_congrats;

    current-index: 3;
    Tab {
        title: "Randomization";
        RandomizationSubmenu {}
    }
    Tab {
        title: "General";
        GeneralSubmenu {}
    }
    Tab {
        title: "Quality of Life";
        qolmenu := QoLSubmenu {}
    }
    Tab {
        title: "About";
        AboutSubmenu {
            sources_generator() => { root.sources_generator(); }
            sources_mod() => { root.sources_mod(); }
        }
    }
}

component RomOutputBar inherits Rectangle {
    callback gen_seed();
    callback pick_rom();
    in property <string> rom_path;
    in property <bool> can_generate;
    in property <int> rom_valid_state;

    HorizontalLayout {
        Rectangle {
            width: parent.width / 2;
            border-color: black;
            border-width: 1px;

            Text {
                x: 16px;
                text: "ROM:";
                font-weight: 800;
                vertical-alignment: center;
            }
            TouchArea {
                x: 60px;
                width: 350px;
                height: parent.height / 2;
                clicked => {root.pick_rom()}
                LineEdit {
                    width: 350px;
                    placeholder-text: rom_path.is-empty ? "Click here to choose CTR NTSC-U ROM ..." : rom_path;
                    enabled: false;
                }
            }
            Text {
                visible: root.rom_valid_state == 2 || root.rom_valid_state == 3;
                x: 430px;
                text: root.rom_valid_state == 3 ? "Valid": "Invalid";
                font-weight: 800;
                color: root.rom_valid_state == 3 ? green : red;
                vertical-alignment: center;
            }
            Text {
                visible: rom_valid_state == 1;
                x: 430px;
                text: "Validating ROM ...";
                font-weight: 800;
                color: red;
                vertical-alignment: center;
            }
        }
        Rectangle {
            border-color: black;
            border-width: 1px;

                Switch {
                    x: 30px;
                    text: "Generate Spoilerlog";
                    checked: true;
                }

                Button {
                    x: 250px;
                    width: 200px;
                    text: "Generate Seed";
                    height: parent.height * (2/3);
                    enabled: can_generate;
                    clicked => {root.gen_seed()}
                }

                Spinner {
                    x: 460px;
                    progress: 0.9;
                }
        }
    }
}

export component MainWindow inherits Window {
    title: "CTR Randomizer";
    width: 1000px;
    height: 600px;
    callback gen_seed();
    callback pick_rom();
    callback sources_generator();
    callback sources_mod();
    in property <string> rom_path;
    in property <bool> can_generate: false;
    in property <int> rom_valid_state: 0;

    out property <bool> qol_skip_mask_hints <=> settings.qol_skip_mask_hints;
    out property <bool> qol_skip_podium <=> settings.qol_skip_podium;
    out property <bool> qol_skip_mask_congrats <=> settings.qol_skip_mask_congrats;

    VerticalLayout {
        TitleBar {
            height: parent.height * 0.18;
        }
        SettingsMetaBar {
            height: parent.height * 0.1;
        }
        settings := SettingsMenu {
            sources_generator() => { root.sources_generator(); }
            sources_mod() => { root.sources_mod(); }
        }
        RomOutputBar {
            height: parent.height * 0.13;
            rom_path: root.rom_path;
            can_generate: root.can_generate;
            rom_valid_state: root.rom_valid_state;
            gen_seed() => { root.gen_seed(); }
            pick_rom() => { root.pick_rom(); }
        }
    }
}
